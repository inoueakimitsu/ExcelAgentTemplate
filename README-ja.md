# ExcelAgentTemplate

## 概要

**ExcelAgentTemplate** は、Microsoft ExcelとPythonを組み合わせた強力なアドインです。このツールを使用することで、Excelの関数を介して最新のLLM（Large Language Models）を活用し、自動化されたエージェントを実行することができます。ユーザーはExcelのセルに特定のプロンプトを記入するだけで、LLMを活用した複雑なクエリやデータ処理タスクを簡単に実行することが可能になります。

たとえば、`=RunAgent("企業情報のリサーチャーとして振舞ってください。" & A1 & "の所在地を調べてください。")` という関数を使用すると、セルA1に入力された企業名の所在地を自動で調査し、結果をExcel上で直接表示します。これにより、手動でのデータ検索と入力の手間が省け、効率的に作業を進めることが可能です。

### 特徴と利点

ExcelAgentTemplateは次のような特徴を持っています：

- **直感的な操作**: Excelの関数として直接LLMを呼び出すため、特別なプログラミング知識は不要です。
- **高度な自動化**: 複雑なデータ収集や処理を自動化し、ワークフローを大幅に効率化します。
- **カスタマイズ可能**: Pythonスクリプトを用いて、特定のニーズに合わせたエージェントの挙動をカスタマイズ可能です。
- **リアルタイム処理**: 非同期処理により、大量のデータも迅速に処理し、結果をリアルタイムで反映します。

### 適用例

|     | A        | B                                                                  | C                                                                                                                              |
| --- | -------- | ------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------ |
| 1   | 企業名   | 従業員数-調査レポート                                             | 従業員数                                                                                                                       |
| 2   | Example  | `=RunAgent("企業" & A2 & "の従業員数を調べてください")`           | `=RunAgent("以下のテキストから、従業員数を取り出してください。結果の数値のみを報告してください。: " & B2)`                  |

### 利用シナリオ

ExcelAgentTemplateは特に以下のような用途に適しています：

- **非定型業務の自動化**: 日々変わる情報を扱う業務で、同じタスクを繰り返す場合に特に有効です。
- **データ収集・分析**: 大量のデータから必要な情報を抽出し、分析する作業を自動化します。
- **レポート作成**: 複数のデータソースから情報を集め、整形してレポートを作成するプロセスを簡略化します。

## 開発者向け情報

### 環境構築 (Python)

1. Python 3.10以上をインストール
2. コマンドプロンプトで以下を実行:
   ```bash
   pip install uv
   uv venv .venv
   .venv\Scripts\activate
   pip install -r requirements.txt
   ```
3. `.env.example`を`.env`にリネームし、必要なAPIキーを設定

### 環境構築 (Excel)

1. Visual Studio で RunAgentClient.sln を開いてビルドしてください。

### 起動方法

1. 仮想環境をアクティブにし (`.\.venv\Scripts\activate`) その後 `python langchain_fastapi.py` を実行
2. `RunAgentClient/bin/Debug/RunAgentClient-AddIn64.xll` をダブルクリックします。
3. "使用できるデジタル署名がありません" という通知画面が表示されます。"このアドインをこのセッションに限り有効にする(E)" をクリックします。このセッションでのみ `RunAgent` 関数が使用できます。
4. そのセッションで空白のブックを新規作成してみましょう。
5. 任意のセルに、例えば `=RunAgent("株式会社 ??? の従業員数を調べてください。")` と入力し、Enter キーを押下します。??? は適当に置き換えてください。
6. `#N/A`と表示されます。Python の画面上では、処理中のログが表示されます。処理が完了すると、セルの内容が実際の出力に置き換わります。

## エージェントを追加するには

- エージェントを実装した API のエンド ポイントを公開します。この際、同一のメッセージが入力された場合のキャッシュ機構を使用すると良いです。
	- 参考 https://python.langchain.com/docs/modules/model_io/llms/llm_caching/
- Excel のアドインは Excel-DNA を使用して作成します。LLM の出力には時間がかかるので、サンプル コードを参考に非同期な処理を行うようにしてください。
	- 参考 https://excel-dna.net/docs/guides-basic/asynchronous-functions
- ウェブ検索に関しては SerpAPI を直に使うことはせず、Tavily を使っています。Tavily は、素の Google 検索や DuckDuckGo、Bing と比べて LLM との相性が良いと印象です。
